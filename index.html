<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The MagmaClustR package implements two main algorithms,
    called Magma and MagmaClust, using a multi-task Gaussian processes
    model to perform predictions for supervised learning problems. Theses
    approaches leverage the learning of cluster-specific mean processes,
    which are common across similar tasks, to provide enhanced prediction
    performances (even far from data) at a linear computational cost (in
    the number of tasks).  MagmaClust is a generalisation of Magma
    where the tasks are simultaneously clustered into groups, each being
    associated to a specific mean process.  User-oriented functions in the
    package are decomposed into training, prediction and plotting
    functions. Some basic features of standard Gaussian processes are also
    implemented.">
<title>Clustering and Prediction using Multi-Task Gaussian Processes with
    Common Mean • MagmaClustR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Clustering and Prediction using Multi-Task Gaussian Processes with
    Common Mean">
<meta property="og:description" content="The MagmaClustR package implements two main algorithms,
    called Magma and MagmaClust, using a multi-task Gaussian processes
    model to perform predictions for supervised learning problems. Theses
    approaches leverage the learning of cluster-specific mean processes,
    which are common across similar tasks, to provide enhanced prediction
    performances (even far from data) at a linear computational cost (in
    the number of tasks).  MagmaClust is a generalisation of Magma
    where the tasks are simultaneously clustered into groups, each being
    associated to a specific mean process.  User-oriented functions in the
    package are decomposed into training, prediction and plotting
    functions. Some basic features of standard Gaussian processes are also
    implemented.">
<meta property="og:image" content="https://arthurleroy.github.io/MagmaClustR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">MagmaClustR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ArthurLeroy/MagmaClustR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="magmaclustr-">MagmaClustR <a class="anchor" aria-label="anchor" href="#magmaclustr-"></a>
</h1>
</div>
<!-- badges: start -->
<p>The <em>MagmaClustR</em> package implements two main algorithms, called Magma (<em>Leroy et al., 2022</em>) and MagmaClust (<em>Leroy et al., 2020</em>), using a multi-task Gaussian processes (GP) model to perform predictions for supervised learning problems. Applications involving functional data, such as multiple time series, are particularly well-handled. Theses approaches leverage the learning of cluster-specific mean processes, which are common across similar tasks, to provide enhanced prediction performances (even far from data points) at a linear computational cost (in the number of tasks). MagmaClust is a generalisation of Magma where the tasks are simultaneously clustered into groups, each being associated to a specific mean process. User-oriented functions in the package are decomposed into training, prediction and plotting functions. Some basic features of standard GPs are also implemented.</p>
<p>Leroy, A., Latouche, P., Guedj, B., Gey, S. MAGMA: inference and prediction using multi-task Gaussian processes with common mean. <em>Mach Learn</em> <strong>111</strong>, 1821–1849 (2022). <a href="https://doi.org/10.1007/s10994-022-06172-1" class="external-link uri">https://doi.org/10.1007/s10994-022-06172-1</a></p>
<p>Leroy, A., Latouche, P., Guedj, B., &amp; Gey, S. Cluster-Specific Predictions with Multi-Task Gaussian Processes. <em>arXiv preprint</em> (2020). <a href="https://arxiv.org/abs/2011.07866" class="external-link uri">https://arxiv.org/abs/2011.07866</a></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of MagmaClustR from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"MagmaClustR"</span><span class="op">)</span></code></pre></div>
<p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ArthurLeroy/MagmaClustR"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-magma">Example: Magma<a class="anchor" aria-label="anchor" href="#example-magma"></a>
</h2>
<p>Here is a basic example on how to simulate a dataset with the adequate format, then train a Magma model and use it to perform predictions.</p>
<div class="section level3">
<h3 id="data-generation">Data generation<a class="anchor" aria-label="anchor" href="#data-generation"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArthurLeroy/MagmaClustR" class="external-link">MagmaClustR</a></span><span class="op">)</span>
<span class="co">## Simulate a dataset with 11 individuals, each observed at 10 input locations</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">data_magma</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">11</span>, N <span class="op">=</span> <span class="fl">10</span>, common_input <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">## Split individuals into training and prediction sets, and define test points</span>
<span class="va">magma_train</span> <span class="op">&lt;-</span> <span class="va">data_magma</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="va">magma_pred</span> <span class="op">&lt;-</span> <span class="va">data_magma</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="va">magma_test</span> <span class="op">&lt;-</span> <span class="va">data_magma</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

<span class="va">data_magma</span>
<span class="co">#&gt; # A tibble: 110 x 3</span>
<span class="co">#&gt;    ID    Output Input</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1       1.52  1.9 </span>
<span class="co">#&gt;  2 1      -5.76  3.3 </span>
<span class="co">#&gt;  3 1      -3.78  3.35</span>
<span class="co">#&gt;  4 1       7.23  5.25</span>
<span class="co">#&gt;  5 1      14.9   6.2 </span>
<span class="co">#&gt;  6 1       7.48  7.4 </span>
<span class="co">#&gt;  7 1       7.21  8.15</span>
<span class="co">#&gt;  8 1      11.5   8.2 </span>
<span class="co">#&gt;  9 1      13.1   8.9 </span>
<span class="co">#&gt; 10 1       8.72  9.5 </span>
<span class="co">#&gt; # ... with 100 more rows</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-prediction-with-magma">Training and prediction with Magma<a class="anchor" aria-label="anchor" href="#training-and-prediction-with-magma"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_magma.html">train_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_train</span><span class="op">)</span>
<span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'ini_hp_0' argument has not been specified. Random values of hyper-parameters for the mean process are used as initialisation.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Called from: train_magma(data = magma_train)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#238: if ("ID" %in% names(hp_0)) {</span>
<span class="co">#&gt;     hp_0 = hp_0[names(hp_0) != "ID"]</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#243: if (kern_i %&gt;% is.function()) {</span>
<span class="co">#&gt;     if (ini_hp_i %&gt;% is.null()) {</span>
<span class="co">#&gt;         stop("When using a custom kernel function the 'ini_hp_i' argument is ", </span>
<span class="co">#&gt;             "mandatory, in order to provide the name of the hyper-parameters. ", </span>
<span class="co">#&gt;             "You can use the function 'hp()' to easily generate a tibble of random", </span>
<span class="co">#&gt;             " hyper-parameters with the desired format for initialisation.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; } else {</span>
<span class="co">#&gt;     if (ini_hp_i %&gt;% is.null()) {</span>
<span class="co">#&gt;         hp_i &lt;- hp(kern_i, list_ID = list_ID, common_hp = common_hp, </span>
<span class="co">#&gt;             noise = TRUE)</span>
<span class="co">#&gt;         cat("The 'ini_hp_i' argument has not been specified. Random values of", </span>
<span class="co">#&gt;             "hyper-parameters for the individal processes are used as", </span>
<span class="co">#&gt;             "initialisation.\n \n")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (!("ID" %in% names(ini_hp_i))) {</span>
<span class="co">#&gt;         hp_i &lt;- tibble::tibble(ID = list_ID, dplyr::bind_rows(ini_hp_i))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (!(all(as.character(ini_hp_i$ID) %in% as.character(list_ID)) &amp; </span>
<span class="co">#&gt;         all(as.character(list_ID) %in% as.character(ini_hp_i$ID)))) {</span>
<span class="co">#&gt;         stop("The 'ID' column in 'ini_hp_i' is different from the 'ID' of the ", </span>
<span class="co">#&gt;             "'data'.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         hp_i &lt;- ini_hp_i</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#253: if (ini_hp_i %&gt;% is.null()) {</span>
<span class="co">#&gt;     hp_i &lt;- hp(kern_i, list_ID = list_ID, common_hp = common_hp, </span>
<span class="co">#&gt;         noise = TRUE)</span>
<span class="co">#&gt;     cat("The 'ini_hp_i' argument has not been specified. Random values of", </span>
<span class="co">#&gt;         "hyper-parameters for the individal processes are used as", </span>
<span class="co">#&gt;         "initialisation.\n \n")</span>
<span class="co">#&gt; } else if (!("ID" %in% names(ini_hp_i))) {</span>
<span class="co">#&gt;     hp_i &lt;- tibble::tibble(ID = list_ID, dplyr::bind_rows(ini_hp_i))</span>
<span class="co">#&gt; } else if (!(all(as.character(ini_hp_i$ID) %in% as.character(list_ID)) &amp; </span>
<span class="co">#&gt;     all(as.character(list_ID) %in% as.character(ini_hp_i$ID)))) {</span>
<span class="co">#&gt;     stop("The 'ID' column in 'ini_hp_i' is different from the 'ID' of the ", </span>
<span class="co">#&gt;         "'data'.")</span>
<span class="co">#&gt; } else {</span>
<span class="co">#&gt;     hp_i &lt;- ini_hp_i</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#254: hp_i &lt;- hp(kern_i, list_ID = list_ID, common_hp = common_hp, </span>
<span class="co">#&gt;     noise = TRUE)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#255: cat("The 'ini_hp_i' argument has not been specified. Random values of", </span>
<span class="co">#&gt;     "hyper-parameters for the individal processes are used as", </span>
<span class="co">#&gt;     "initialisation.\n \n")</span>
<span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individal processes are used as initialisation.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#278: if (!("noise" %in% names(hp_i))) {</span>
<span class="co">#&gt;     if (common_hp) {</span>
<span class="co">#&gt;         hp_i &lt;- hp_i %&gt;% dplyr::mutate(hp(NULL, noise = T))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         hp_i &lt;- hp_i %&gt;% dplyr::left_join(hp(NULL, list_ID = hp_i$ID, </span>
<span class="co">#&gt;             noise = T), by = "ID")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#288: hp_i_ini &lt;- hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#289: hp_0_ini &lt;- hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#291: cv &lt;- FALSE</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#292: logL_monitoring &lt;- -Inf</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#293: seq_loglikelihood &lt;- c()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#296: for (i in 1:n_iter_max) {</span>
<span class="co">#&gt;     t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt;     post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt;     if (fast_approx) {</span>
<span class="co">#&gt;         seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;             db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;             post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;         cv &lt;- FALSE</span>
<span class="co">#&gt;         break</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;         post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt;     new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt;     new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt;     if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;         warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;             i))</span>
<span class="co">#&gt;         warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;             "last valid iteration are returned.")</span>
<span class="co">#&gt;         break</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt;     if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;         diff_logL &lt;- -Inf</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;         warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt;     hp_i &lt;- new_hp_i</span>
<span class="co">#&gt;     logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt;     eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt;     if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;         eps &lt;- 1</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt;     paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;         units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt;     paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;         " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;         cat()</span>
<span class="co">#&gt;     if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;         cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;             "\n \n")</span>
<span class="co">#&gt;         cv &lt;- TRUE</span>
<span class="co">#&gt;         break</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 1: 12.94 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -379.55987 --- Convergence ratio = Inf</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 2: 6.75 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -374.3461 --- Convergence ratio = 0.01393</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 3: 6.17 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -374.17964 --- Convergence ratio = 0.00044</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#413: cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;     "\n \n")</span>
<span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#417: cv &lt;- TRUE</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#418: break</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#422: if (!cv &amp; (i == n_iter_max)) {</span>
<span class="co">#&gt;     warning("The EM algorithm has reached the maximum number of iterations ", </span>
<span class="co">#&gt;         "before convergence, training might be sub-optimal \n \n")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#430: if (!is.null(grid_inputs)) {</span>
<span class="co">#&gt;     cat("Start evaluating hyper-posterior distribution of the mean process", </span>
<span class="co">#&gt;         "on the provided grid of inputs... \n \n")</span>
<span class="co">#&gt;     post &lt;- hyperposterior(data = data, hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         kern_0 = kern_0, kern_i = kern_i, prior_mean = prior_mean, </span>
<span class="co">#&gt;         grid_inputs = grid_inputs, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cat("Done!\n \n")</span>
<span class="co">#&gt; } else {</span>
<span class="co">#&gt;     post$pred &lt;- tibble::tibble(Input = post$mean %&gt;% dplyr::pull(.data$Input), </span>
<span class="co">#&gt;         Mean = post$mean %&gt;% dplyr::pull(.data$Output), Var = post$cov %&gt;% </span>
<span class="co">#&gt;             diag() %&gt;% as.vector())</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#449: post$pred &lt;- tibble::tibble(Input = post$mean %&gt;% dplyr::pull(.data$Input), </span>
<span class="co">#&gt;     Mean = post$mean %&gt;% dplyr::pull(.data$Output), Var = post$cov %&gt;% </span>
<span class="co">#&gt;         diag() %&gt;% as.vector())</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#457: fct_args &lt;- list(data = data, prior_mean = prior_mean, ini_hp_0 = hp_0_ini, </span>
<span class="co">#&gt;     ini_hp_i = hp_i_ini, kern_0 = kern_0, kern_i = kern_i, common_hp = common_hp, </span>
<span class="co">#&gt;     grid_inputs = grid_inputs, pen_diag = pen_diag, n_iter_max = n_iter_max, </span>
<span class="co">#&gt;     cv_threshold = cv_threshold)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#471: t_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#473: list(hp_0 = hp_0, hp_i = hp_i, hyperpost = post, ini_args = fct_args, </span>
<span class="co">#&gt;     seq_loglikelihood = seq_loglikelihood, converged = cv, training_time = difftime(t_2, </span>
<span class="co">#&gt;         t_1, units = "secs")) %&gt;% return()</span>

<span class="va">pred</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_magma.html">pred_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_pred</span>,
                    trained_model <span class="op">=</span> <span class="va">model</span>, 
                    grid_inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  Start evaluating the hyper-posterior on the correct inputs...</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper-prior mean function is thus set to be 0 everywhere.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Done!</span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="reference/figures/README-train_and_predict_Magma-1.png" width="100%"></p>
<p>Note that the <code>grid_inputs</code> argument is optional. It merely allows users to control the grid of values on which the prediction is performed.</p>
</div>
<div class="section level3">
<h3 id="display-the-resulting-predictions">Display the resulting predictions<a class="anchor" aria-label="anchor" href="#display-the-resulting-predictions"></a>
</h3>
<p>Several arguments are available in a specific plotting function to offer additional control in the display of results. For instance, the GP prediction can be represented as a heatmap of probabilities:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot_gp.html">plot_gp</a></span><span class="op">(</span>pred_gp <span class="op">=</span> <span class="va">pred</span>,
        data <span class="op">=</span> <span class="va">magma_pred</span>,
        data_train <span class="op">=</span> <span class="va">magma_train</span>,
        prior_mean <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">hyperpost</span><span class="op">$</span><span class="va">mean</span>,
        heatmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p><img src="reference/figures/README-display_Magma-1.png" width="100%"></p>
<p>Additionally, it is also possible to create animated representations by using functions that generate GIFs. For instance, below, the true testing points have been represented as red dots and we can observe how the prediction evolves as we add more data points to our prediction dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_gif</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_gif.html">pred_gif</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_pred</span>,
                      trained_model <span class="op">=</span> <span class="va">model</span>,
                      grid_inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  =&gt; 1 =&gt; 2 =&gt; 3 =&gt; 4 =&gt; 5</span>

<span class="fu"><a href="reference/plot_gif.html">plot_gif</a></span><span class="op">(</span>pred_gp <span class="op">=</span> <span class="va">pred_gif</span>,
        data <span class="op">=</span> <span class="va">magma_pred</span>,
        data_train <span class="op">=</span> <span class="va">magma_train</span>,
        prior_mean <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">hyperpost</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_test</span>,
                       <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Input</span>, y <span class="op">=</span> <span class="va">Output</span><span class="op">)</span>,
                       color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-gif_Magma-1.gif" width="100%"></p>
<p>Note that the <code>grid_inputs</code> argument is optional. It merely allows users to control the grid of values on which the prediction is performed.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-magmaclust">Example: MagmaClust<a class="anchor" aria-label="anchor" href="#example-magmaclust"></a>
</h2>
<p>Here is a basic example on how to simulate a dataset with the adequate format, then train a MagmaClust model and use it to perform simultaneous clustering and predictions.</p>
<div class="section level3">
<h3 id="data-generation-1">Data generation<a class="anchor" aria-label="anchor" href="#data-generation-1"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Simulate a dataset containing 3 clusters of 4 individuals, each observed at 10 input locations</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> 
<span class="va">data_magmaclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">4</span>, N <span class="op">=</span> <span class="fl">10</span>, K <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> 
<span class="co">## Split individuals into training and prediction sets, and define test points</span>
<span class="va">list_ID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data_magmaclust</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span>
<span class="va">magmaclust_train</span> <span class="op">&lt;-</span> <span class="va">data_magmaclust</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">list_ID</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span>
<span class="va">magmaclust_pred</span> <span class="op">&lt;-</span> <span class="va">data_magmaclust</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="va">list_ID</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="va">magmaclust_test</span> <span class="op">&lt;-</span> <span class="va">data_magmaclust</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="va">list_ID</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

<span class="va">data_magmaclust</span>
<span class="co">#&gt; # A tibble: 120 x 3</span>
<span class="co">#&gt;    ID         Output Input</span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 ID1-Clust1 -11.1   0.25</span>
<span class="co">#&gt;  2 ID1-Clust1  -7.64  0.8 </span>
<span class="co">#&gt;  3 ID1-Clust1  -4.91  2   </span>
<span class="co">#&gt;  4 ID1-Clust1 -13.2   4.2 </span>
<span class="co">#&gt;  5 ID1-Clust1 -14.3   4.6 </span>
<span class="co">#&gt;  6 ID1-Clust1 -13.0   6.2 </span>
<span class="co">#&gt;  7 ID1-Clust1 -14.1   6.75</span>
<span class="co">#&gt;  8 ID1-Clust1 -20.3   7.95</span>
<span class="co">#&gt;  9 ID1-Clust1 -14.5   8.85</span>
<span class="co">#&gt; 10 ID1-Clust1 -12.2   9.85</span>
<span class="co">#&gt; # ... with 110 more rows</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-prediction-with-magmaclust">Training and prediction with MagmaClust<a class="anchor" aria-label="anchor" href="#training-and-prediction-with-magmaclust"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_magmaclust.html">train_magmaclust</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magmaclust_train</span><span class="op">)</span>
<span class="co">#&gt; The number of cluster argument has not been specified. There will be 3 cluster by default. </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individual processes are used as initialisation.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'ini_hp_k' argument has not been specified. Random values of hyper-parameters for the mean processes are used as initialisation.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; VEM algorithm, step 1: 68.63 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Value of the elbo: -403.8673 --- Convergence ratio = Inf</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; VEM algorithm, step 2: 26.25 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Value of the elbo: -383.34763 --- Convergence ratio = 0.05353</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; VEM algorithm, step 3: 22.03 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Value of the elbo: -383.08831 --- Convergence ratio = 0.00068</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span>
<span class="co">#&gt; </span>

<span class="va">pred_clust</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_magmaclust.html">pred_magmaclust</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magmaclust_pred</span>,
                    trained_model <span class="op">=</span> <span class="va">model_clust</span>,
                    grid_inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span>, 
                    plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs. Start evaluating the hyper-posterior on the correct inputs...</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'prior_mean_k' argument has not been specified. The hyper-prior  mean functions are thus set to be 0 everywhere.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Done!</span>
<span class="co">#&gt; </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="display-the-resulting-predictions-1">Display the resulting predictions<a class="anchor" aria-label="anchor" href="#display-the-resulting-predictions-1"></a>
</h3>
<p>As before, a specific plotting function is provided. For MagmaClust, we advise to use the heatmap representation in priority, as a mixture of GPs may not be unimodal in general (and thus prevents the definition of Credible Interval).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Allocate individuals to their most probable cluster to colour them by clusters afterwards</span>
<span class="va">data_train_with_clust</span> <span class="op">=</span> <span class="fu"><a href="reference/data_allocate_cluster.html">data_allocate_cluster</a></span><span class="op">(</span><span class="va">model_clust</span><span class="op">)</span>

<span class="fu"><a href="reference/plot_magmaclust.html">plot_magmaclust</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">pred_clust</span>,
                cluster <span class="op">=</span> <span class="st">"all"</span>,
                data <span class="op">=</span> <span class="va">magmaclust_pred</span>,
                data_train <span class="op">=</span> <span class="va">data_train_with_clust</span>,
                col_clust <span class="op">=</span> <span class="cn">TRUE</span>,
                prior_mean <span class="op">=</span> <span class="va">model_clust</span><span class="op">$</span><span class="va">hyperpost</span><span class="op">$</span><span class="va">mean</span>,
                y_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, <span class="fl">0.5</span><span class="op">)</span>,
                heatmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p><img src="reference/figures/README-display_MagmaClust-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-in-2-dimensions">Example: in 2-dimensions<a class="anchor" aria-label="anchor" href="#example-in-2-dimensions"></a>
</h2>
<p>Although unidimensional-input problems are easier to visualise, both Magma and MagmaClust can also be applied with as many covariates as desired in the model.</p>
<div class="section level3">
<h3 id="data-generation-2">Data generation<a class="anchor" aria-label="anchor" href="#data-generation-2"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArthurLeroy/MagmaClustR" class="external-link">MagmaClustR</a></span><span class="op">)</span>
<span class="co">## Dataset with 11 individuals, 10 reference input locations and a covariate</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> 
<span class="va">data_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">11</span>, N <span class="op">=</span> <span class="fl">10</span>, covariate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 
<span class="co">## Split individuals into training and prediction sets, and define test points</span>
<span class="va">dim2_train</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="va">dim2_pred</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="va">dim2_test</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

<span class="va">data_dim2</span>
<span class="co">#&gt; # A tibble: 110 x 4</span>
<span class="co">#&gt;    ID    Output Input Covariate</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     -11.1   0.25     -2   </span>
<span class="co">#&gt;  2 1      -7.64  0.8       1.94</span>
<span class="co">#&gt;  3 1      -4.91  2         4.64</span>
<span class="co">#&gt;  4 1     -13.2   4.2      -3.7 </span>
<span class="co">#&gt;  5 1     -14.3   4.6      -4.24</span>
<span class="co">#&gt;  6 1     -13.0   6.2       0.68</span>
<span class="co">#&gt;  7 1     -14.1   6.75      0.55</span>
<span class="co">#&gt;  8 1     -20.3   7.95     -4.38</span>
<span class="co">#&gt;  9 1     -14.5   8.85      1.74</span>
<span class="co">#&gt; 10 1     -12.2   9.85      4.14</span>
<span class="co">#&gt; # ... with 100 more rows</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-prediction-with-magma-1">Training and prediction with Magma<a class="anchor" aria-label="anchor" href="#training-and-prediction-with-magma-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_magma.html">train_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_train</span><span class="op">)</span>
<span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'ini_hp_0' argument has not been specified. Random values of hyper-parameters for the mean process are used as initialisation.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Called from: train_magma(data = dim2_train)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#238: if ("ID" %in% names(hp_0)) {</span>
<span class="co">#&gt;     hp_0 = hp_0[names(hp_0) != "ID"]</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#243: if (kern_i %&gt;% is.function()) {</span>
<span class="co">#&gt;     if (ini_hp_i %&gt;% is.null()) {</span>
<span class="co">#&gt;         stop("When using a custom kernel function the 'ini_hp_i' argument is ", </span>
<span class="co">#&gt;             "mandatory, in order to provide the name of the hyper-parameters. ", </span>
<span class="co">#&gt;             "You can use the function 'hp()' to easily generate a tibble of random", </span>
<span class="co">#&gt;             " hyper-parameters with the desired format for initialisation.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; } else {</span>
<span class="co">#&gt;     if (ini_hp_i %&gt;% is.null()) {</span>
<span class="co">#&gt;         hp_i &lt;- hp(kern_i, list_ID = list_ID, common_hp = common_hp, </span>
<span class="co">#&gt;             noise = TRUE)</span>
<span class="co">#&gt;         cat("The 'ini_hp_i' argument has not been specified. Random values of", </span>
<span class="co">#&gt;             "hyper-parameters for the individal processes are used as", </span>
<span class="co">#&gt;             "initialisation.\n \n")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (!("ID" %in% names(ini_hp_i))) {</span>
<span class="co">#&gt;         hp_i &lt;- tibble::tibble(ID = list_ID, dplyr::bind_rows(ini_hp_i))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (!(all(as.character(ini_hp_i$ID) %in% as.character(list_ID)) &amp; </span>
<span class="co">#&gt;         all(as.character(list_ID) %in% as.character(ini_hp_i$ID)))) {</span>
<span class="co">#&gt;         stop("The 'ID' column in 'ini_hp_i' is different from the 'ID' of the ", </span>
<span class="co">#&gt;             "'data'.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         hp_i &lt;- ini_hp_i</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#253: if (ini_hp_i %&gt;% is.null()) {</span>
<span class="co">#&gt;     hp_i &lt;- hp(kern_i, list_ID = list_ID, common_hp = common_hp, </span>
<span class="co">#&gt;         noise = TRUE)</span>
<span class="co">#&gt;     cat("The 'ini_hp_i' argument has not been specified. Random values of", </span>
<span class="co">#&gt;         "hyper-parameters for the individal processes are used as", </span>
<span class="co">#&gt;         "initialisation.\n \n")</span>
<span class="co">#&gt; } else if (!("ID" %in% names(ini_hp_i))) {</span>
<span class="co">#&gt;     hp_i &lt;- tibble::tibble(ID = list_ID, dplyr::bind_rows(ini_hp_i))</span>
<span class="co">#&gt; } else if (!(all(as.character(ini_hp_i$ID) %in% as.character(list_ID)) &amp; </span>
<span class="co">#&gt;     all(as.character(list_ID) %in% as.character(ini_hp_i$ID)))) {</span>
<span class="co">#&gt;     stop("The 'ID' column in 'ini_hp_i' is different from the 'ID' of the ", </span>
<span class="co">#&gt;         "'data'.")</span>
<span class="co">#&gt; } else {</span>
<span class="co">#&gt;     hp_i &lt;- ini_hp_i</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#254: hp_i &lt;- hp(kern_i, list_ID = list_ID, common_hp = common_hp, </span>
<span class="co">#&gt;     noise = TRUE)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#255: cat("The 'ini_hp_i' argument has not been specified. Random values of", </span>
<span class="co">#&gt;     "hyper-parameters for the individal processes are used as", </span>
<span class="co">#&gt;     "initialisation.\n \n")</span>
<span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individal processes are used as initialisation.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#278: if (!("noise" %in% names(hp_i))) {</span>
<span class="co">#&gt;     if (common_hp) {</span>
<span class="co">#&gt;         hp_i &lt;- hp_i %&gt;% dplyr::mutate(hp(NULL, noise = T))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         hp_i &lt;- hp_i %&gt;% dplyr::left_join(hp(NULL, list_ID = hp_i$ID, </span>
<span class="co">#&gt;             noise = T), by = "ID")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#288: hp_i_ini &lt;- hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#289: hp_0_ini &lt;- hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#291: cv &lt;- FALSE</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#292: logL_monitoring &lt;- -Inf</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#293: seq_loglikelihood &lt;- c()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#296: for (i in 1:n_iter_max) {</span>
<span class="co">#&gt;     t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt;     post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt;     if (fast_approx) {</span>
<span class="co">#&gt;         seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;             db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;             post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;         cv &lt;- FALSE</span>
<span class="co">#&gt;         break</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;         post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt;     new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt;     new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt;     if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;         warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;             i))</span>
<span class="co">#&gt;         warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;             "last valid iteration are returned.")</span>
<span class="co">#&gt;         break</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt;     if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;         diff_logL &lt;- -Inf</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;         warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt;     hp_i &lt;- new_hp_i</span>
<span class="co">#&gt;     logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt;     eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt;     if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;         eps &lt;- 1</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt;     paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;         units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt;     paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;         " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;         cat()</span>
<span class="co">#&gt;     if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;         cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;             "\n \n")</span>
<span class="co">#&gt;         cv &lt;- TRUE</span>
<span class="co">#&gt;         break</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 1: 15.34 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -242.84823 --- Convergence ratio = Inf</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 2: 21.3 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -231.94883 --- Convergence ratio = 0.04699</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 3: 15.56 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -231.6273 --- Convergence ratio = 0.00139</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#299: t_i_1 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#302: post &lt;- e_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     hp_0 = hp_0, hp_i = hp_i, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#313: if (fast_approx) {</span>
<span class="co">#&gt;     seq_loglikelihood &lt;- logL_monitoring(hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;         post_mean = post$mean, post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cv &lt;- FALSE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#332: new_hp &lt;- m_step(db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, </span>
<span class="co">#&gt;     old_hp_0 = hp_0, old_hp_i = hp_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, common_hp = common_hp, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#344: new_hp_0 &lt;- new_hp$hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#345: new_hp_i &lt;- new_hp$hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#348: if (any(is.na(new_hp_0)) | any(is.na(new_hp_i))) {</span>
<span class="co">#&gt;     warning(paste0("The M-step encountered an error at iteration : ", </span>
<span class="co">#&gt;         i))</span>
<span class="co">#&gt;     warning("Training has stopped and hyper-parameters values from the ", </span>
<span class="co">#&gt;         "last valid iteration are returned.")</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#358: new_logL_monitoring &lt;- logL_monitoring(hp_0 = new_hp_0, hp_i = new_hp_i, </span>
<span class="co">#&gt;     db = data, m_0 = m_0, kern_0 = kern_0, kern_i = kern_i, post_mean = post$mean, </span>
<span class="co">#&gt;     post_cov = post$cov, pen_diag = pen_diag)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#370: diff_logL &lt;- new_logL_monitoring - logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#371: if (diff_logL %&gt;% is.nan()) {</span>
<span class="co">#&gt;     diff_logL &lt;- -Inf</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#375: if (diff_logL &lt; 0) {</span>
<span class="co">#&gt;     warning("The likelihood descreased. Possible numerical issues.")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#380: hp_0 &lt;- new_hp_0</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#381: hp_i &lt;- new_hp_i</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#382: logL_monitoring &lt;- new_logL_monitoring</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#385: seq_loglikelihood &lt;- c(seq_loglikelihood, logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#388: eps &lt;- diff_logL/abs(logL_monitoring)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#389: if (eps %&gt;% is.nan()) {</span>
<span class="co">#&gt;     eps &lt;- 1</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#394: t_i_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#395: paste0("EM algorithm, step ", i, ": ", difftime(t_i_2, t_i_1, </span>
<span class="co">#&gt;     units = "secs") %&gt;% round(2), " seconds \n \n") %&gt;% cat()</span>
<span class="co">#&gt; EM algorithm, step 4: 10.33 seconds </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#402: paste0("Value of the likelihood: ", logL_monitoring %&gt;% round(5), </span>
<span class="co">#&gt;     " --- Convergence ratio = ", eps %&gt;% round(5), "\n \n") %&gt;% </span>
<span class="co">#&gt;     cat()</span>
<span class="co">#&gt; Value of the likelihood: -231.61445 --- Convergence ratio = 6e-05</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#412: if (abs(eps) &lt; cv_threshold) {</span>
<span class="co">#&gt;     cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;         "\n \n")</span>
<span class="co">#&gt;     cv &lt;- TRUE</span>
<span class="co">#&gt;     break</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#413: cat("The EM algorithm successfully converged, training is completed.", </span>
<span class="co">#&gt;     "\n \n")</span>
<span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#417: cv &lt;- TRUE</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#418: break</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#422: if (!cv &amp; (i == n_iter_max)) {</span>
<span class="co">#&gt;     warning("The EM algorithm has reached the maximum number of iterations ", </span>
<span class="co">#&gt;         "before convergence, training might be sub-optimal \n \n")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#430: if (!is.null(grid_inputs)) {</span>
<span class="co">#&gt;     cat("Start evaluating hyper-posterior distribution of the mean process", </span>
<span class="co">#&gt;         "on the provided grid of inputs... \n \n")</span>
<span class="co">#&gt;     post &lt;- hyperposterior(data = data, hp_0 = hp_0, hp_i = hp_i, </span>
<span class="co">#&gt;         kern_0 = kern_0, kern_i = kern_i, prior_mean = prior_mean, </span>
<span class="co">#&gt;         grid_inputs = grid_inputs, pen_diag = pen_diag)</span>
<span class="co">#&gt;     cat("Done!\n \n")</span>
<span class="co">#&gt; } else {</span>
<span class="co">#&gt;     post$pred &lt;- tibble::tibble(Input = post$mean %&gt;% dplyr::pull(.data$Input), </span>
<span class="co">#&gt;         Mean = post$mean %&gt;% dplyr::pull(.data$Output), Var = post$cov %&gt;% </span>
<span class="co">#&gt;             diag() %&gt;% as.vector())</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#449: post$pred &lt;- tibble::tibble(Input = post$mean %&gt;% dplyr::pull(.data$Input), </span>
<span class="co">#&gt;     Mean = post$mean %&gt;% dplyr::pull(.data$Output), Var = post$cov %&gt;% </span>
<span class="co">#&gt;         diag() %&gt;% as.vector())</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#457: fct_args &lt;- list(data = data, prior_mean = prior_mean, ini_hp_0 = hp_0_ini, </span>
<span class="co">#&gt;     ini_hp_i = hp_i_ini, kern_0 = kern_0, kern_i = kern_i, common_hp = common_hp, </span>
<span class="co">#&gt;     grid_inputs = grid_inputs, pen_diag = pen_diag, n_iter_max = n_iter_max, </span>
<span class="co">#&gt;     cv_threshold = cv_threshold)</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#471: t_2 &lt;- Sys.time()</span>
<span class="co">#&gt; debug at C:/Users/user/Mon Drive/Travail/GitHub/MagmaClustR/R/training.R#473: list(hp_0 = hp_0, hp_i = hp_i, hyperpost = post, ini_args = fct_args, </span>
<span class="co">#&gt;     seq_loglikelihood = seq_loglikelihood, converged = cv, training_time = difftime(t_2, </span>
<span class="co">#&gt;         t_1, units = "secs")) %&gt;% return()</span>

<span class="va">pred_dim2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_magma.html">pred_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_pred</span>,
                         trained_model <span class="op">=</span> <span class="va">model_dim2</span><span class="op">)</span>
<span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  Start evaluating the hyper-posterior on the correct inputs...</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper-prior mean function is thus set to be 0 everywhere.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Done!</span>
<span class="co">#&gt; </span></code></pre></div>
<p><img src="reference/figures/README-train_and_predict_Magma_in_2-D-1.png" width="100%"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ArthurLeroy/MagmaClustR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ArthurLeroy/MagmaClustR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing MagmaClustR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Arthur Leroy <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-0806-8934" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Pierre Latouche <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ArthurLeroy/MagmaClustR/actions" class="external-link"><img src="https://github.com/ArthurLeroy/MagmaClustR/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/ArthurLeroy/MagmaClustR" class="external-link"><img src="https://codecov.io/gh/ArthurLeroy/MagmaClustR/branch/master/graph/badge.svg?token=KH7SOKOLKX" alt="codecov"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arthur Leroy, Pierre Latouche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
