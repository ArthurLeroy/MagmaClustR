<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="An implementation for the multi-task Gaussian processes with common 
    mean framework. Two main algorithms, called Magma and MagmaClust, 
    are available to perform predictions for supervised learning problems, in
    particular for time series or any functional/continuous data applications.
    The corresponding articles has been respectively proposed by Arthur Leroy, 
    Pierre Latouche, Benjamin Guedj and Servane Gey (2022) 
    &lt;doi:10.1007/s10994-022-06172-1&gt;, and Arthur Leroy, Pierre Latouche, 
    Benjamin Guedj and Servane Gey (2023) &lt;https://jmlr.org/papers/v24/20-1321.html&gt;.
    Theses approaches leverage the learning of cluster-specific mean processes,
    which are common across similar tasks, to provide enhanced prediction
    performances (even far from data) at a linear computational cost (in
    the number of tasks).  MagmaClust is a generalisation of Magma
    where the tasks are simultaneously clustered into groups, each being
    associated to a specific mean process.  User-oriented functions in the
    package are decomposed into training, prediction and plotting
    functions. Some basic features (classic kernels, training, prediction) of
    standard Gaussian processes are also implemented. ">
<title>Clustering and Prediction using Multi-Task Gaussian Processes with
    Common Mean • MagmaClustR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Clustering and Prediction using Multi-Task Gaussian Processes with
    Common Mean">
<meta property="og:description" content="An implementation for the multi-task Gaussian processes with common 
    mean framework. Two main algorithms, called Magma and MagmaClust, 
    are available to perform predictions for supervised learning problems, in
    particular for time series or any functional/continuous data applications.
    The corresponding articles has been respectively proposed by Arthur Leroy, 
    Pierre Latouche, Benjamin Guedj and Servane Gey (2022) 
    &lt;doi:10.1007/s10994-022-06172-1&gt;, and Arthur Leroy, Pierre Latouche, 
    Benjamin Guedj and Servane Gey (2023) &lt;https://jmlr.org/papers/v24/20-1321.html&gt;.
    Theses approaches leverage the learning of cluster-specific mean processes,
    which are common across similar tasks, to provide enhanced prediction
    performances (even far from data) at a linear computational cost (in
    the number of tasks).  MagmaClust is a generalisation of Magma
    where the tasks are simultaneously clustered into groups, each being
    associated to a specific mean process.  User-oriented functions in the
    package are decomposed into training, prediction and plotting
    functions. Some basic features (classic kernels, training, prediction) of
    standard Gaussian processes are also implemented. ">
<meta property="og:image" content="https://arthurleroy.github.io/MagmaClustR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">MagmaClustR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/example-in-2D.html">Multi-dimensional inputs in Magma</a>
    <a class="dropdown-item" href="articles/how-to-use-magma.html">How to use Magma</a>
    <a class="dropdown-item" href="articles/how-to-use-magmaclust.html">How to use MagmaClust</a>
    <a class="dropdown-item" href="articles/standard-GP.html">Gaussian Process regression</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ArthurLeroy/MagmaClustR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="magmaclustr-">MagmaClustR <a class="anchor" aria-label="anchor" href="#magmaclustr-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The <em>MagmaClustR</em> package implements two main algorithms, called Magma (<em>Leroy et al., 2022</em>) and MagmaClust (<em>Leroy et al., 2020</em>), using a multi-task Gaussian processes (GP) model to perform predictions for supervised learning problems. Applications involving functional data, such as multiple time series, are particularly well-handled. Theses approaches leverage the learning of cluster-specific mean processes, which are common across similar tasks, to provide enhanced prediction performances (even far from data points) at a linear computational cost (in the number of tasks). MagmaClust is a generalisation of Magma where the tasks are simultaneously clustered into groups, each being associated to a specific mean process. User-oriented functions in the package are decomposed into training, prediction and plotting functions. Some basic features of standard GPs are also implemented.</p>
<p>Leroy, A., Latouche, P., Guedj, B., Gey, S. MAGMA: inference and prediction using multi-task Gaussian processes with common mean. <em>Mach Learn</em> <strong>111</strong>, 1821–1849 (2022). <a href="https://doi.org/10.1007/s10994-022-06172-1" class="external-link uri">https://doi.org/10.1007/s10994-022-06172-1</a></p>
<p>Leroy, A., Latouche, P., Guedj, B., &amp; Gey, S. Cluster-Specific Predictions with Multi-Task Gaussian Processes. <em>JMLR</em> 24(5):1−49, (2023). <a href="https://www.jmlr.org/papers/v24/20-1321.html" class="external-link uri">https://www.jmlr.org/papers/v24/20-1321.html</a></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of MagmaClustR from <a href="https://CRAN.R-project.org" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"MagmaClustR"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ArthurLeroy/MagmaClustR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-magma">Example: Magma<a class="anchor" aria-label="anchor" href="#example-magma"></a>
</h2>
<p>Here is a basic example on how to simulate a dataset with the adequate format, then train a Magma model and use it to perform predictions.</p>
<div class="section level3">
<h3 id="data-generation">Data generation<a class="anchor" aria-label="anchor" href="#data-generation"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArthurLeroy/MagmaClustR" class="external-link">MagmaClustR</a></span><span class="op">)</span></span>
<span><span class="co">## Simulate a dataset with 11 individuals, each observed at 10 input locations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span></span>
<span><span class="va">data_magma</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">11</span>, N <span class="op">=</span> <span class="fl">10</span>, common_input <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## Split individuals into training and prediction sets, and define test points</span></span>
<span><span class="va">magma_train</span> <span class="op">&lt;-</span> <span class="va">data_magma</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">magma_pred</span> <span class="op">&lt;-</span> <span class="va">data_magma</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">magma_test</span> <span class="op">&lt;-</span> <span class="va">data_magma</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_magma</span></span>
<span><span class="co">#&gt; # A tibble: 110 x 3</span></span>
<span><span class="co">#&gt;    ID    Input Output</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 1      1.3  -20.7 </span></span>
<span><span class="co">#&gt;  2 1      2.65 -24.2 </span></span>
<span><span class="co">#&gt;  3 1      2.8  -24.4 </span></span>
<span><span class="co">#&gt;  4 1      3.3  -25.6 </span></span>
<span><span class="co">#&gt;  5 1      3.8  -23.9 </span></span>
<span><span class="co">#&gt;  6 1      5    -11.4 </span></span>
<span><span class="co">#&gt;  7 1      6.1   -4.97</span></span>
<span><span class="co">#&gt;  8 1      6.35  -4.35</span></span>
<span><span class="co">#&gt;  9 1      7.55  -6.63</span></span>
<span><span class="co">#&gt; 10 1      9.8   -8.68</span></span>
<span><span class="co">#&gt; # i 100 more rows</span></span></code></pre></div>
<p>As displayed above, any dataset processed in MagmaClustR should provide columns named <code>ID</code>, <code>Input</code>, and <code>Output</code>. Any additional column would be treated as a covariate (and thus define multi-dimensional inputs).</p>
</div>
<div class="section level3">
<h3 id="training-and-prediction-with-magma">Training and prediction with Magma<a class="anchor" aria-label="anchor" href="#training-and-prediction-with-magma"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_magma.html">train_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_train</span>, common_hp <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_0' argument has not been specified. Random values of hyper-parameters for the mean process are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individal processes are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 1: 7.86 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -313.47546 --- Convergence ratio = Inf</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 2: 4.38 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -303.47668 --- Convergence ratio = 0.03295</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 3: 3.1 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -302.84575 --- Convergence ratio = 0.00208</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 4: 2.9 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -302.56379 --- Convergence ratio = 0.00093</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">pred</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_magma.html">pred_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_pred</span>,</span>
<span>                    trained_model <span class="op">=</span> <span class="va">model</span>, </span>
<span>                    grid_inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  Start evaluating the hyper-posterior on the correct inputs...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper-prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'hp' argument has not been specified. The 'train_gp()' function (with random initialisation) has been used to learn ML estimators for the hyper-parameters associated with the 'kern' argument.</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p><img src="reference/figures/README-train_and_predict_Magma-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Note that the <code>common_hp</code> and <code>grid_inputs</code> arguments are optional. They respectively indicate that a specific set of hyper-parameters is trained for each curve, and control the grid of values on which the prediction is performed.</p>
</div>
<div class="section level3">
<h3 id="display-the-resulting-predictions">Display the resulting predictions<a class="anchor" aria-label="anchor" href="#display-the-resulting-predictions"></a>
</h3>
<p>Several other arguments are available in dedicated plotting functions to offer extended options in the display of results. For instance, the GP predictions can be represented as a heatmap of probabilities:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_gp.html">plot_gp</a></span><span class="op">(</span>pred_gp <span class="op">=</span> <span class="va">pred</span>,</span>
<span>        data <span class="op">=</span> <span class="va">magma_pred</span>,</span>
<span>        data_train <span class="op">=</span> <span class="va">magma_train</span>,</span>
<span>        prior_mean <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">hyperpost</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>        heatmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/README-display_Magma-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Additionally, it is also possible to create animated representations by using functions that generate GIFs. For instance, below, the true testing points have been represented as red dots and we can observe how the prediction evolves as we add more data points to our prediction dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_gif</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_gif.html">pred_gif</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_pred</span>,</span>
<span>                      trained_model <span class="op">=</span> <span class="va">model</span>,</span>
<span>                      grid_inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  =&gt; 1 =&gt; 2 =&gt; 3 =&gt; 4 =&gt; 5 =&gt; 6 =&gt; 7</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_gif.html">plot_gif</a></span><span class="op">(</span>pred_gp <span class="op">=</span> <span class="va">pred_gif</span>,</span>
<span>         data <span class="op">=</span> <span class="va">magma_pred</span>,</span>
<span>         data_train <span class="op">=</span> <span class="va">magma_train</span>,</span>
<span>         prior_mean <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">hyperpost</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magma_test</span>,</span>
<span>                      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Input</span>, y <span class="op">=</span> <span class="va">Output</span><span class="op">)</span>,</span>
<span>                      color <span class="op">=</span> <span class="st">'red'</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-gif_Magma-1.gif" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-magmaclust">Example: MagmaClust<a class="anchor" aria-label="anchor" href="#example-magmaclust"></a>
</h2>
<p>Here is a basic example on how to simulate a dataset with the adequate format, then train a MagmaClust model and use it to perform simultaneous clustering and predictions.</p>
<div class="section level3">
<h3 id="data-generation-1">Data generation<a class="anchor" aria-label="anchor" href="#data-generation-1"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Simulate a dataset containing 3 clusters of 4 individuals, each observed at 10 input locations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> </span>
<span><span class="va">data_magmaclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">4</span>, N <span class="op">=</span> <span class="fl">10</span>, K <span class="op">=</span> <span class="fl">3</span>, common_input <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co">## Split individuals into training and prediction sets, and define test points</span></span>
<span><span class="va">list_ID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data_magmaclust</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span></span>
<span><span class="va">magmaclust_train</span> <span class="op">&lt;-</span> <span class="va">data_magmaclust</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">list_ID</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">magmaclust_pred</span> <span class="op">&lt;-</span> <span class="va">data_magmaclust</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="va">list_ID</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">magmaclust_test</span> <span class="op">&lt;-</span> <span class="va">data_magmaclust</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="va">list_ID</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_magmaclust</span></span>
<span><span class="co">#&gt; # A tibble: 120 x 3</span></span>
<span><span class="co">#&gt;    ID         Input Output</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 ID1-Clust1  0.2   32.4 </span></span>
<span><span class="co">#&gt;  2 ID1-Clust1  0.7   28.8 </span></span>
<span><span class="co">#&gt;  3 ID1-Clust1  2.05   6.62</span></span>
<span><span class="co">#&gt;  4 ID1-Clust1  2.1    5.46</span></span>
<span><span class="co">#&gt;  5 ID1-Clust1  3.15  -5.44</span></span>
<span><span class="co">#&gt;  6 ID1-Clust1  5.3  -16.5 </span></span>
<span><span class="co">#&gt;  7 ID1-Clust1  6.4  -24.7 </span></span>
<span><span class="co">#&gt;  8 ID1-Clust1  7.35 -31.4 </span></span>
<span><span class="co">#&gt;  9 ID1-Clust1  7.5  -32.4 </span></span>
<span><span class="co">#&gt; 10 ID1-Clust1  8.95 -42.7 </span></span>
<span><span class="co">#&gt; # i 110 more rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-prediction-with-magmaclust">Training and prediction with MagmaClust<a class="anchor" aria-label="anchor" href="#training-and-prediction-with-magmaclust"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_magmaclust.html">train_magmaclust</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magmaclust_train</span><span class="op">)</span></span>
<span><span class="co">#&gt; The number of cluster argument has not been specified. There will be 3 cluster by default. </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individual processes are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_k' argument has not been specified. Random values of hyper-parameters for the mean processes are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; VEM algorithm, step 1: 20.35 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the elbo: -712.16808 --- Convergence ratio = Inf</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; VEM algorithm, step 2: 11.52 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the elbo: -635.70636 --- Convergence ratio = 0.12028</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; VEM algorithm, step 3: 19.46 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the elbo: -623.0371 --- Convergence ratio = 0.02033</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; VEM algorithm, step 4: 9.89 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the elbo: -619.56266 --- Convergence ratio = 0.00561</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; VEM algorithm, step 5: 7.93 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the elbo: -618.50147 --- Convergence ratio = 0.00172</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; VEM algorithm, step 6: 7.68 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the elbo: -617.95297 --- Convergence ratio = 0.00089</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">pred_clust</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_magmaclust.html">pred_magmaclust</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">magmaclust_pred</span>,</span>
<span>                               trained_model <span class="op">=</span> <span class="va">model_clust</span>,</span>
<span>                               grid_inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span>, </span>
<span>                               plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs. Start evaluating the hyper-posterior on the correct inputs...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'prior_mean_k' argument has not been specified. The hyper-prior  mean functions are thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="display-the-resulting-predictions-1">Display the resulting predictions<a class="anchor" aria-label="anchor" href="#display-the-resulting-predictions-1"></a>
</h3>
<p>As before, a specific plotting function is provided. For MagmaClust, we advise to use the heatmap representation in priority, as a mixture of GPs may not be unimodal in general (and thus prevents the definition of Credible Interval).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Allocate individuals to their most probable cluster to colour them by clusters afterwards</span></span>
<span><span class="va">data_train_with_clust</span> <span class="op">=</span> <span class="fu"><a href="reference/data_allocate_cluster.html">data_allocate_cluster</a></span><span class="op">(</span><span class="va">model_clust</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_magmaclust.html">plot_magmaclust</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">pred_clust</span>,</span>
<span>                cluster <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                data <span class="op">=</span> <span class="va">magmaclust_pred</span>,</span>
<span>                data_train <span class="op">=</span> <span class="va">data_train_with_clust</span>,</span>
<span>                col_clust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                prior_mean <span class="op">=</span> <span class="va">model_clust</span><span class="op">$</span><span class="va">hyperpost</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>                y_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">55</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                heatmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; The mixture probability of the cluster K1 is 1. Therefore, the predictive distribution is Gaussian and the associated credible interval can be displayed.</span></span></code></pre></div>
<p><img src="reference/figures/README-display_MagmaClust-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-in-2-dimensions">Example: in 2-dimensions<a class="anchor" aria-label="anchor" href="#example-in-2-dimensions"></a>
</h2>
<p>Although unidimensional-input problems are easier to visualise, both Magma and MagmaClust can also be applied with as many covariates as desired in the model.</p>
<div class="section level3">
<h3 id="data-generation-2">Data generation<a class="anchor" aria-label="anchor" href="#data-generation-2"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Dataset with 11 individuals, 10 reference input locations and a covariate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> </span>
<span><span class="va">data_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">11</span>, N <span class="op">=</span> <span class="fl">10</span>, covariate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">## Split individuals into training and prediction sets, and define test points</span></span>
<span><span class="va">dim2_train</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">dim2_pred</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_dim2</span></span>
<span><span class="co">#&gt; # A tibble: 110 x 4</span></span>
<span><span class="co">#&gt;    ID    Input Covariate Output</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 1      1.85       4.5  21.3 </span></span>
<span><span class="co">#&gt;  2 1      2.85       8.5   5.21</span></span>
<span><span class="co">#&gt;  3 1      2          4    24.8 </span></span>
<span><span class="co">#&gt;  4 1      3.25       7    12.3 </span></span>
<span><span class="co">#&gt;  5 1      3.5        2.5  37.0 </span></span>
<span><span class="co">#&gt;  6 1      5.3        5.5  20.0 </span></span>
<span><span class="co">#&gt;  7 1      6.5        5    20.8 </span></span>
<span><span class="co">#&gt;  8 1      6          2    34.1 </span></span>
<span><span class="co">#&gt;  9 1      7.3        9.5   5.18</span></span>
<span><span class="co">#&gt; 10 1      9.2        7.5   7.20</span></span>
<span><span class="co">#&gt; # i 100 more rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-prediction-with-magma-1">Training and prediction with Magma<a class="anchor" aria-label="anchor" href="#training-and-prediction-with-magma-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train_magma.html">train_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_train</span><span class="op">)</span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_0' argument has not been specified. Random values of hyper-parameters for the mean process are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individal processes are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 1: 6.02 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -247.66608 --- Convergence ratio = Inf</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 2: 5.71 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -217.29028 --- Convergence ratio = 0.13979</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 3: 3.44 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -216.11346 --- Convergence ratio = 0.00545</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 4: 3.59 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -216.02699 --- Convergence ratio = 4e-04</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">pred_dim2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/pred_magma.html">pred_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_pred</span>,</span>
<span>                         trained_model <span class="op">=</span> <span class="va">model_dim2</span><span class="op">)</span></span>
<span><span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  Start evaluating the hyper-posterior on the correct inputs...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper-prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p><img src="reference/figures/README-train_and_predict_Magma_in_2-D-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=MagmaClustR" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ArthurLeroy/MagmaClustR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ArthurLeroy/MagmaClustR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing MagmaClustR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Arthur Leroy <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-0806-8934" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Pierre Latouche <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ArthurLeroy/MagmaClustR/actions" class="external-link"><img src="https://github.com/ArthurLeroy/MagmaClustR/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/ArthurLeroy/MagmaClustR" class="external-link"><img src="https://codecov.io/gh/ArthurLeroy/MagmaClustR/branch/master/graph/badge.svg?token=KH7SOKOLKX" alt="codecov"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arthur Leroy, Pierre Latouche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
