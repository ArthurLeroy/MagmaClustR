<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Training MagmaClust with a Variational EM algorithm — train_magmaclust • MagmaClustR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Training MagmaClust with a Variational EM algorithm — train_magmaclust"><meta name="description" content="The hyper-parameters and the hyper-posterior distributions involved in
MagmaClust can be learned thanks to a VEM algorithm implemented in
train_magmaclust. By providing a dataset, the model hypotheses
(hyper-prior mean parameters, covariance kernels and number of clusters) and
initialisation values for the hyper-parameters, the function computes
maximum likelihood estimates of the HPs as well as the mean and covariance
parameters of the Gaussian hyper-posterior distributions of the mean
processes."><meta property="og:description" content="The hyper-parameters and the hyper-posterior distributions involved in
MagmaClust can be learned thanks to a VEM algorithm implemented in
train_magmaclust. By providing a dataset, the model hypotheses
(hyper-prior mean parameters, covariance kernels and number of clusters) and
initialisation values for the hyper-parameters, the function computes
maximum likelihood estimates of the HPs as well as the mean and covariance
parameters of the Gaussian hyper-posterior distributions of the mean
processes."><meta property="og:image" content="https://arthurleroy.github.io/MagmaClustR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MagmaClustR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/example-in-2D.html">Multi-dimensional inputs in Magma</a></li>
    <li><a class="dropdown-item" href="../articles/how-to-use-magma.html">How to use Magma</a></li>
    <li><a class="dropdown-item" href="../articles/how-to-use-magmaclust.html">How to use MagmaClust</a></li>
    <li><a class="dropdown-item" href="../articles/standard-GP.html">Gaussian Process regression</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ArthurLeroy/MagmaClustR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Training MagmaClust with a Variational EM algorithm</h1>
      <small class="dont-index">Source: <a href="https://github.com/ArthurLeroy/MagmaClustR/blob/master/R/training.R" class="external-link"><code>R/training.R</code></a></small>
      <div class="d-none name"><code>train_magmaclust.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The hyper-parameters and the hyper-posterior distributions involved in
MagmaClust can be learned thanks to a VEM algorithm implemented in
<code>train_magmaclust</code>. By providing a dataset, the model hypotheses
(hyper-prior mean parameters, covariance kernels and number of clusters) and
initialisation values for the hyper-parameters, the function computes
maximum likelihood estimates of the HPs as well as the mean and covariance
parameters of the Gaussian hyper-posterior distributions of the mean
processes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">train_magmaclust</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  nb_cluster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prior_mean_k <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ini_hp_k <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ini_hp_i <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  kern_k <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>  kern_i <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>  ini_mixture <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  common_hp_k <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  common_hp_i <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid_inputs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pen_diag <span class="op">=</span> <span class="fl">1e-10</span>,</span>
<span>  n_iter_max <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  cv_threshold <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  fast_approx <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A tibble or data frame. Columns required: <code>ID</code>, <code>Input</code>
, <code>Output</code>. Additional columns for covariates can be specified.
The <code>ID</code> column contains the unique names/codes used to identify each
individual/task (or batch of data).
The <code>Input</code> column should define the variable that is used as
reference for the observations (e.g. time for longitudinal data). The
<code>Output</code> column specifies the observed values (the response
variable). The data frame can also provide as many covariates as desired,
with no constraints on the column names. These covariates are additional
inputs (explanatory variables) of the models that are also observed at
each reference <code>Input</code>.</p></dd>


<dt id="arg-nb-cluster">nb_cluster<a class="anchor" aria-label="anchor" href="#arg-nb-cluster"></a></dt>
<dd><p>A number, indicating the number of clusters of
individuals/tasks that are assumed to exist among the dataset.</p></dd>


<dt id="arg-prior-mean-k">prior_mean_k<a class="anchor" aria-label="anchor" href="#arg-prior-mean-k"></a></dt>
<dd><p>The set of hyper-prior mean parameters (m_k) for the K
mean GPs, one value for each cluster.
cluster. This argument can be specified under various formats, such as:</p><ul><li><p>NULL (default). All hyper-prior means would be set to 0 everywhere.</p></li>
<li><p>A numerical vector of the same length as the number of clusters.
Each number is associated with one cluster, and considered
to be the hyper-prior mean parameter of the cluster (i.e. a constant
function at all <code>Input</code>).</p></li>
<li><p>A list of functions. Each function is associated with one cluster. These
functions are all evaluated at all <code>Input</code> values, to provide
specific hyper-prior mean vectors for each cluster.</p></li>
</ul></dd>


<dt id="arg-ini-hp-k">ini_hp_k<a class="anchor" aria-label="anchor" href="#arg-ini-hp-k"></a></dt>
<dd><p>A tibble or data frame of hyper-parameters
associated with <code>kern_k</code>, the mean process' kernel.
Required column : <code>ID</code>. The <code>ID</code> column contains the unique
names/codes used to identify each cluster. The other columns
should be named according to the hyper-parameters that are used in
<code>kern_k</code>. The <code><a href="hp.html">hp</a></code> function can be used to draw
custom hyper-parameters with the correct format.</p></dd>


<dt id="arg-ini-hp-i">ini_hp_i<a class="anchor" aria-label="anchor" href="#arg-ini-hp-i"></a></dt>
<dd><p>A tibble or data frame of hyper-parameters
associated with <code>kern_i</code>, the individual processes' kernel.
Required column : <code>ID</code>. The <code>ID</code> column contains the unique
names/codes used to identify each individual/task. The other columns
should be named according to the hyper-parameters that are used in
<code>kern_i</code>. The <code><a href="hp.html">hp</a></code> function can be used to draw
custom hyper-parameters with the correct format.</p></dd>


<dt id="arg-kern-k">kern_k<a class="anchor" aria-label="anchor" href="#arg-kern-k"></a></dt>
<dd><p>A kernel function, associated with the mean GPs.
Several popular kernels
(see <a href="https://www.cs.toronto.edu/~duvenaud/cookbook/" class="external-link">The Kernel
Cookbook</a>) are already implemented and can be selected within the
following list:</p><ul><li><p>"SE": (default value) the Squared Exponential Kernel (also called
Radial Basis Function or Gaussian kernel),</p></li>
<li><p>"LIN": the Linear kernel,</p></li>
<li><p>"PERIO": the Periodic kernel,</p></li>
<li><p>"RQ": the Rational Quadratic kernel.
Compound kernels can be created as sums or products of the above kernels.
For combining kernels, simply provide a formula as a character string
where elements are separated by whitespaces (e.g. "SE + PERIO"). As the
elements are treated sequentially from the left to the right, the product
operator '*' shall always be used before the '+' operators (e.g.
'SE * LIN + RQ' is valid whereas 'RQ + SE * LIN' is  not).</p></li>
</ul></dd>


<dt id="arg-kern-i">kern_i<a class="anchor" aria-label="anchor" href="#arg-kern-i"></a></dt>
<dd><p>A kernel function, associated with the individual GPs. (See
details above in <code>kern_k</code>).</p></dd>


<dt id="arg-ini-mixture">ini_mixture<a class="anchor" aria-label="anchor" href="#arg-ini-mixture"></a></dt>
<dd><p>Initial values of the probability to belong to each
cluster for each individual (<code><a href="ini_mixture.html">ini_mixture</a></code> can be used for
a k-means initialisation. Used by default if NULL).</p></dd>


<dt id="arg-common-hp-k">common_hp_k<a class="anchor" aria-label="anchor" href="#arg-common-hp-k"></a></dt>
<dd><p>A boolean indicating whether hyper-parameters are common
among the mean GPs.</p></dd>


<dt id="arg-common-hp-i">common_hp_i<a class="anchor" aria-label="anchor" href="#arg-common-hp-i"></a></dt>
<dd><p>A boolean indicating whether hyper-parameters are common
among the individual GPs.</p></dd>


<dt id="arg-grid-inputs">grid_inputs<a class="anchor" aria-label="anchor" href="#arg-grid-inputs"></a></dt>
<dd><p>A vector, indicating the grid of additional reference
inputs on which the mean processes' hyper-posteriors should be evaluated.</p></dd>


<dt id="arg-pen-diag">pen_diag<a class="anchor" aria-label="anchor" href="#arg-pen-diag"></a></dt>
<dd><p>A number. A jitter term, added on the diagonal to prevent
numerical issues when inverting nearly singular matrices.</p></dd>


<dt id="arg-n-iter-max">n_iter_max<a class="anchor" aria-label="anchor" href="#arg-n-iter-max"></a></dt>
<dd><p>A number, indicating the maximum number of iterations of
the VEM algorithm to proceed while not reaching convergence.</p></dd>


<dt id="arg-cv-threshold">cv_threshold<a class="anchor" aria-label="anchor" href="#arg-cv-threshold"></a></dt>
<dd><p>A number, indicating the threshold of the likelihood gain
under which the VEM algorithm will stop. The convergence condition is
defined as the difference of elbo between two consecutive steps,
divided by the absolute value of the last one
( \((ELBO_n - ELBO_{n-1}) / |ELBO_n| \) ).</p></dd>


<dt id="arg-fast-approx">fast_approx<a class="anchor" aria-label="anchor" href="#arg-fast-approx"></a></dt>
<dd><p>A boolean, indicating whether the VEM algorithm should
stop after only one iteration of the VE-step. This advanced feature is
mainly used to provide a faster approximation of the model selection
procedure, by preventing any optimisation over the hyper-parameters.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list, containing the results of the VEM algorithm used in the
training step of MagmaClust. The elements of the list are:</p><ul><li><p>hp_k: A tibble containing the trained hyper-parameters for the mean
process' kernel and the mixture proportions for each cluster.</p></li>
<li><p>hp_i: A tibble containing the trained hyper-parameters for the
individual processes' kernels.</p></li>
<li><p>hyperpost: A sub-list containing the parameters of the mean processes'
hyper-posterior distribution, namely:</p><ul><li><p>mean: A list of tibbles containing, for each cluster, the
hyper-posterior mean parameters evaluated at each <code>Input</code>.</p></li>
<li><p>cov: A list of matrices containing, for each cluster, the
hyper-posterior covariance parameter of the mean process.</p></li>
<li><p>mixture: A tibble, indicating the mixture probabilities in each
cluster for each individual.</p></li>
</ul></li>
<li><p>ini_args: A list containing the initial function arguments and values
for the hyper-prior means, the hyper-parameters. In particular, if
those arguments were set to NULL, <code>ini_args</code> allows us to retrieve
the (randomly chosen) initialisations used during training.</p></li>
<li><p>seq_elbo: A vector, containing the sequence of ELBO values associated
with each iteration.</p></li>
<li><p>converged: A logical value indicated whether the algorithm converged.</p></li>
<li><p>training_time: Total running time of the complete training.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The user can specify custom kernel functions for the argument
<code>kern_k</code> and <code>kern_i</code>. The hyper-parameters used in the kernel
should have explicit names, and be contained within the <code>hp</code>
argument. <code>hp</code> should typically be defined as a named vector or a
data frame. Although it is not mandatory for the <code>train_magmaclust</code>
function to run, gradients be can provided within kernel function
definition. See for example <code><a href="se_kernel.html">se_kernel</a></code> to create a custom
kernel function displaying an adequate format to be used in
MagmaClust.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="cn">TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arthur Leroy, Pierre Latouche.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

