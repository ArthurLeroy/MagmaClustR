<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MagmaClustR">
<title>Multi-dimensional inputs in Magma • MagmaClustR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multi-dimensional inputs in Magma">
<meta property="og:description" content="MagmaClustR">
<meta property="og:image" content="https://arthurleroy.github.io/MagmaClustR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MagmaClustR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-in-2D.html">Multi-dimensional inputs in Magma</a>
    <a class="dropdown-item" href="../articles/how-to-use-magma.html">How to use Magma</a>
    <a class="dropdown-item" href="../articles/how-to-use-magmaclust.html">How to use MagmaClust</a>
    <a class="dropdown-item" href="../articles/standard-GP.html">Gaussian Process regression</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ArthurLeroy/MagmaClustR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multi-dimensional inputs in Magma</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ArthurLeroy/MagmaClustR/blob/HEAD/vignettes/articles/example-in-2D.Rmd" class="external-link"><code>vignettes/articles/example-in-2D.Rmd</code></a></small>
      <div class="d-none name"><code>example-in-2D.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArthurLeroy/MagmaClustR" class="external-link">MagmaClustR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>In <a href="https://arthurleroy.github.io/MagmaClustR/articles/how-to-use-magmaclust.html">Magma</a>
and <a href="https://arthurleroy.github.io/MagmaClustR/articles/how-to-use-magmaclust.html">MagmaClust</a>
vignettes, it has been emphasised that, to be processed within
<code>MagmaClustR</code>, a dataset must contain at least 3 mandatory
columns: <code>ID</code>, <code>Input</code> and <code>Output</code>.
However, let us point out that both <em>Magma</em> and
<em>MagmaClust</em> can also handle multi-dimensional inputs. Notice
that there are no constraints on the names of the additional input
columns (except for the name <em>Reference</em> that is used internally
in the code and should be <strong>strictly</strong> avoided).</p>
<p>Throughout the following synthetic example, the <em>Magma</em>
algorithm is applied to tackle a 2-dimensional forecasting problem. More
specifically, the model is trained on a dataset that contains 2 input
variables, namely <code>Input</code> and <code>Covariate</code>.</p>
</div>
<div class="section level2">
<h2 id="data-generation">Data generation<a class="anchor" aria-label="anchor" href="#data-generation"></a>
</h2>
<p>To explore the features of Magma in 2D, we simulate a synthetic
dataset thanks to the <code><a href="../reference/simu_db.html">simu_db()</a></code> function. To customise this
dataset, we can specify several parameters, such as:</p>
<ul>
<li><p>the number <strong>K</strong> of underlying clusters in our
dataset. Since we do not assume that there are group structures in our
data, we set <code>K = 1</code> (default).</p></li>
<li><p>the number <strong>M</strong> of individuals per cluster. Even if
Magma performances improve with respect to the number of training
individuals, 30 are more than enough to get an idea of how this 2D
version works. Thus, we specify <code>M = 31</code>: 30 individuals for
the training, 1 for the prediction.</p></li>
<li><p>the number <strong>N</strong> of observations per individual.
Here, we set <code>N = 10</code> data points.</p></li>
<li><p>the presence / absence of an additional input named
<code>Covariate</code>. As we want to handle multi-dimensional inputs,
we specify <code>covariate = TRUE</code>.</p></li>
<li><p>the fact that all individuals share common inputs (regular or
irregular measurements among individuals). Here, we set
<code>common_input = FALSE</code> to define a grid that covers various
regions of the input space (<code>Input</code> and
<code>Covariate</code>).</p></li>
</ul>
<p>Many additional arguments are available, see <a href="https://arthurleroy.github.io/MagmaClustR/reference/simu_db.html"><code>simu_db()</code></a>
for details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">data_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simu_db.html">simu_db</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">31</span>, </span>
<span>                     N <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                     K <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                     covariate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     common_input <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_dim2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="right">Input</th>
<th align="right">Covariate</th>
<th align="right">Output</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0.95</td>
<td align="right">6.0</td>
<td align="right">5.145306</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">1.80</td>
<td align="right">2.5</td>
<td align="right">7.277505</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">2.35</td>
<td align="right">4.0</td>
<td align="right">10.054762</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">3.65</td>
<td align="right">2.0</td>
<td align="right">17.831701</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">5.15</td>
<td align="right">7.0</td>
<td align="right">18.321026</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">5.30</td>
<td align="right">0.5</td>
<td align="right">17.015734</td>
</tr>
</tbody>
</table>
<p>To provide a visual intuition of the values contained in training
set, we can display raw data (using the signature gradient colour of
<code>MagmaClustR</code> ;) ) with the following code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_dim2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Input</span>, y <span class="op">=</span> <span class="va">Covariate</span>, fill <span class="op">=</span> <span class="va">Output</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"white"</span>,</span>
<span>    <span class="st">"#FDE0DD"</span>,</span>
<span>    <span class="st">"#FCC5C0"</span>,</span>
<span>    <span class="st">"#FA9FB5"</span>,</span>
<span>    <span class="st">"#F768A1"</span>,</span>
<span>    <span class="st">"#DD3497"</span>,</span>
<span>    <span class="st">"#AE017E"</span>,</span>
<span>    <span class="st">"#7A0177"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-in-2D_files/figure-html/unnamed-chunk-4-1.png" width="2187.5" style="display: block; margin: auto;"></p>
<p>Let us mention that any dataset in <code>MagmaClustR</code> can be
regularised if necessary (in the sense that we can modify the input grid
to match a specific format). To this end, the
<code><a href="../reference/regularize_data.html">regularize_data()</a></code> function is proposed, allowing us to
constrain the number of data points per input, or specify ‘by hand’ a
surrogate grid of inputs on which to project our data. This function
takes the arguments:</p>
<ul>
<li>
<code>data</code>,corresponding to database we want to
regularise;</li>
<li>
<code>size_grid</code>, indicating how many points each axis of the
grid must contain;</li>
<li>
<code>grid_inputs</code>, the grid on which we want to project our
data. If NULL (default), a dedicated grid of inputs is defined: for each
input column, a regular sequence is created from the min input values to
the max, with a number of equispaced points equal to the ‘size_grid’
argument. We could also project our data on a specific
<code>grid_inputs</code> (which may come from the dedicated
<code><a href="../reference/expand_grid_inputs.html">expand_grid_inputs()</a></code> function; see <strong>Customise
graphs</strong> for details). This grid does not necessarily have the
same number of points along all axes.</li>
<li>
<code>summarise_fct</code>, a function used to summarise data points
if several similar inputs are associated with different outputs.</li>
</ul>
<p>For instance, if we would want to evaluate our synthetic dataset on a
<span class="math inline">\(5 \times 5\)</span> grid of inputs summarise
the projected outputs according through their mean, we could call:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dim2_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regularize_data.html">regularize_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_dim2</span>,</span>
<span>                             size_grid <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                             grid_inputs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             summarise_fct <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_dim2_reg</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="right">Input</th>
<th align="right">Covariate</th>
<th align="right">Output</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0.0</td>
<td align="right">5.0</td>
<td align="right">5.145306</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">2.5</td>
<td align="right">2.5</td>
<td align="right">12.554603</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">2.5</td>
<td align="right">5.0</td>
<td align="right">10.054762</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">5.0</td>
<td align="right">0.0</td>
<td align="right">17.015734</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">5.0</td>
<td align="right">7.5</td>
<td align="right">18.321026</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">7.5</td>
<td align="right">5.0</td>
<td align="right">25.512476</td>
</tr>
</tbody>
</table>
<p>Finally, we split our individuals into training and prediction
sets.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dim2_train</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">dim2_pred</span> <span class="op">&lt;-</span> <span class="va">data_dim2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op">==</span> <span class="fl">31</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="training-and-prediction-in-2-d">Training and prediction in 2-D<a class="anchor" aria-label="anchor" href="#training-and-prediction-in-2-d"></a>
</h2>
<p>The overall process of <em>Magma</em> remains identical as in the 1-D
case, and can be decomposed in 3 main steps: <strong>training,
prediction</strong> and <strong>plotting of results</strong>. We refer
to the <a href="https://arthurleroy.github.io/MagmaClustR/articles/how-to-use-magmaclust.html">Magma
vignette</a> for the complete description of the classical pipeline: -
we call the <a href="https://arthurleroy.github.io/MagmaClustR/reference/train_magma.html"><code>train_magma()</code></a>
function to train our model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">model_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_magma.html">train_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_train</span>, </span>
<span>                          kern_0 <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>                          kern_i <span class="op">=</span> <span class="st">"SE"</span>,</span>
<span>                          common_hp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper_prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_0' argument has not been specified. Random values of hyper-parameters for the mean process are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'ini_hp_i' argument has not been specified. Random values of hyper-parameters for the individal processes are used as initialisation.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 1: 8.97 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -1113.45324 --- Convergence ratio = Inf</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 2: 6.97 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -1079.21656 --- Convergence ratio = 0.03172</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; EM algorithm, step 3: 6.96 seconds </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Value of the likelihood: -1078.66572 --- Convergence ratio = 0.00051</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The EM algorithm successfully converged, training is completed. </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<ul>
<li>we perform prediction for a new individual thanks to <a href="https://arthurleroy.github.io/MagmaClustR/reference/pred_magma.html"><code>pred_magma()</code></a>.
Here, we do not specify the <code>grid_inputs</code> argument; in this
case, a default grid is automatically generated by
<code><a href="../reference/pred_magma.html">pred_magma()</a></code>, ranging between the <em>min</em> and
<em>max</em> <code>Input</code> and <code>Covariate</code> values of our
dataset. However, if we want to perform prediction on a specific 2-D
area, we could provide a specific <code>grid_inputs</code>; see
<strong>Even prettier graphics</strong> section for details.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_dim2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_magma.html">pred_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_pred</span>,</span>
<span>                         trained_model <span class="op">=</span> <span class="va">model_dim2</span>,</span>
<span>                         plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  Start evaluating the hyper-posterior on the correct inputs...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper-prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<ul>
<li>we display the results with <a href="https://arthurleroy.github.io/MagmaClustR/reference/plot_gp.html"><code>plot_gp()</code></a>.
As this step constitutes the main evolution of the one-dimensional
version, we devote an entire section to discuss it below.</li>
</ul>
</div>
<div class="section level2">
<h2 id="display-of-results">Display of results<a class="anchor" aria-label="anchor" href="#display-of-results"></a>
</h2>
<p>With the <a href="https://arthurleroy.github.io/MagmaClustR/reference/plot_gp.html"><code>plot_gp()</code></a>
function, we can display the predicted posterior mean values of
<code>ID = 31</code>. The prediction is represented as a 2-D heatmap of
probabilities where:</p>
<ul>
<li>the x-axis corresponds to the <code>Input</code> column of our
dataset; the y-axis, to the <code>Covariate</code> column;</li>
<li>each (x,y) couple of inputs is associated with a colour (from a
colour gradient range) corresponding to the posterior mean value at this
input. The darker the posterior mean, the higher the value;</li>
<li>the uncertainty is represented on the graph by the
transparency/opacity associated with the previous colour. The narrower
the 95% Credible Interval, the more opaque the associated colour.</li>
</ul>
<p>Unfortunately, 2-D inputs inevitably lead to constraints when it
comes to visualisation, preventing us to provide as much information as
for 1-D. In particular, the graph below does not display the mean
process nor the training data, as we were not able to find appropriate
representations (that would also not surcharge the graph).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_gp.html">plot_gp</a></span><span class="op">(</span>pred_gp <span class="op">=</span> <span class="va">pred_dim2</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dim2_pred</span><span class="op">)</span> </span></code></pre></div>
<p><img src="example-in-2D_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="customise-graphs">Customise graphs<a class="anchor" aria-label="anchor" href="#customise-graphs"></a>
</h3>
<div class="section level4">
<h4 id="with-a-specific-grid-of-inputs">With a specific grid of inputs<a class="anchor" aria-label="anchor" href="#with-a-specific-grid-of-inputs"></a>
</h4>
<p>As with the unidimensional version, we can create our own grid of
inputs if we want to perform prediction on a specific 2D area
(potentially wider than the dataset one). Contrary to the unidimensional
version, the <code>grid_inputs</code> can no longer be a simple sequence
of numbers for which the prediction must be performed, but a 2D grid
containing :</p>
<ul>
<li>on the x-axis, a sequence of <code>Input</code> for which we want to
perform prediction ;</li>
<li>on the y-axis, a sequence of <code>Covariate</code> for which we
want to perform prediction.</li>
</ul>
<p>To create our grid, we use the <code>create_grid_inputs()</code>
function. We only have to specify a sequence of <code>Input</code> and
as many covariates as we want. However, we must also ensure that we do
not generate too much data points ; we recall that Magma has a cubic
complexity, so the execution can be extremely long depending on the
number and length of sequences. Therefore, we advise to reduce the
length of the Inputs sequences if we want to perform a high dimensional
prediction. Moreover, each Input must have the same name as in the data
base to avoid errors during the prediction step.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_inputs_dim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand_grid_inputs.html">expand_grid_inputs</a></span><span class="op">(</span>Input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">0.5</span><span class="op">)</span>, Covariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_dim2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_magma.html">pred_magma</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dim2_pred</span>,</span>
<span>                         trained_model <span class="op">=</span> <span class="va">model_dim2</span>,</span>
<span>                         grid_inputs <span class="op">=</span> <span class="va">grid_inputs_dim2</span>,</span>
<span>                         plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The hyper-posterior distribution of the mean process provided in 'hyperpost' argument isn't evaluated on the expected inputs.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  Start evaluating the hyper-posterior on the correct inputs...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; The 'prior_mean' argument has not been specified. The hyper-prior mean function is thus set to be 0 everywhere.</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p><img src="example-in-2D_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Here, we perform prediction on a <code>grid_inputs</code> wider than
the one generated automatically by <code><a href="../reference/pred_magma.html">pred_magma()</a></code>. For
<code>Input</code> values higher than the dataset ones, no observations
are available, neither from <code>ID = 31</code> nor from the training
dataset. Magma behaves as expected, with a slow drifting to the prior
mean (here, zero) and an highly increasing variance.</p>
</div>
<div class="section level4">
<h4 id="create-a-2d-gif">Create a 2D GIF<a class="anchor" aria-label="anchor" href="#create-a-2d-gif"></a>
</h4>
<p>As with 1-D Magma, it is possible to create animated representations
thanks to <a href="https://arthurleroy.github.io/MagmaClustR/reference/pred_gif.html"><code>pred_gif()</code></a>
and <a href="https://arthurleroy.github.io/MagmaClustR/reference/plot_gif.html"><code>plot_gif()</code></a>.</p>
<p>These functions offer dynamic plots by generating GIFs thanks to
<code>gganimate</code> package. Then, we can observe how the prediction
evolves as we add more data points to our prediction dataset.</p>
<p><code><a href="../reference/pred_gif.html">pred_gif()</a></code> and <code><a href="../reference/plot_gif.html">plot_gif()</a></code> functions work
the same as <code><a href="../reference/pred_magma.html">pred_magma()</a></code> and <code><a href="../reference/plot_gp.html">plot_gp()</a></code> in the
2D version. Some extra arguments can be customized in
<code><a href="../reference/plot_gif.html">plot_gif()</a></code>, like adjusting the GIF speed, saving the
plotted GIF, etc…</p>
<div class="section level5">
<h5 id="magma-2-d-vs-gp-2-d">Magma 2-D vs GP 2-D<a class="anchor" aria-label="anchor" href="#magma-2-d-vs-gp-2-d"></a>
</h5>
<p>The MagmaClustR package also provides a prediction with classic GPs
in 2D; thus, we can compare Magma and classic GPs predictions.</p>
<p>The graphs below correspond to the 2D dynamic prediction with Magma
(first one) and classic GP (second one).</p>
<p><img src="../../docs/articles/example-in-2D_files/figure-html/unnamed-chunk-13-1.gif" width="80%" style="display: block; margin: auto;"></p>
<p><img src="../../docs/articles/example-in-2D_files/figure-html/unnamed-chunk-14-1.gif" width="80%" style="display: block; margin: auto;"></p>
<p>This example highlights the advantage of sharing information across
individuals: even before seeing any data, Magma provides an already
accurate mean process. As we add more data for the individual of
interest, the uncertainty of predictions slightly decreases, although
the main trend remains mainly similar.</p>
<p>On the other hand, the classic GP struggles to find the shape of the
underlying process. On unobserved regions of the graph, the prediction
remains far from the original process. As expected, though, the more
data we add, the better becomes the prediction with standard GP.</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Arthur Leroy, Pierre Latouche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
